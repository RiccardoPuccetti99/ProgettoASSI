<% content_for :body do %>

  <main style="background-color: rgb(14, 4, 14);">
    <div class="bg-image d-flex justify-content-center align-items-center" style="
    background: url(<%= asset_path 'tftOpaco.png' %>);
    background-repeat: no-repeat;
    height:40vh;
    background-position:center;
    ">
      <div style=" background-color:rgba(0,0,0,0.6)">
        <div class="d-flex justify-content-center align-items-center h-100">


          <!-- Navbar -->
          <nav class="navbar navbar-expand-lg navbar-dark riquadro">
            <!-- Container wrapper -->
            <div class="container-fluid">

              <!-- Collapsible wrapper -->
              <div class="w-auto">

                <!-- Dropdown -->
                <select id="regionSelector" name="region" class="custom-select my-1 mr-sm-2" id="RegionSelector"
                  style="background-color: #160220; color: white;">
                  <option value="euw1">EUW1</option>
                  <option value="br1">BR1</option>
                  <option value="eun1">EUN1</option>
                  <option value="jp1">JP1</option>
                  <option value="kr">KR</option>
                  <option value="la1">LA1</option>
                  <option value="la2">LA2</option>
                  <option value="na1">NA1</option>
                  <option value="oc1">OC1</option>
                  <option value="ru">RU</option>
                  <option value="tr1">TR1</option>
                </select>

                <!-- Search -->

                <input type="search" spellcheck="false" id="summonerName" name="summoner" class="form-control"
                  placeholder="Summoner name" aria-label="Search" style="background-color: #160220; color: white;">

                <div class=" buttonForm">
                  <button type="button" id="btn-submit" class=" btn btn-light btn-primary" data-mdb-ripple-color="dark"
                    style="background-color: #160220; color: white;">Search</button>
                </div>
              </div>

            </div>
        </div>
        <!-- Container wrapper -->
        </nav>
        <!-- Navbar -->

      </div>
    </div>
    <!--fine maschera-->



    <!-- stampa-->
    <div class="container" style="padding-top: 50px;">
      <div id="rowLeague" class="row">
        <div id="summ" class="col-6 col-md-3 col-sm-6 center_box">
        </div>
        <div id="piespace" class="col-6 col-md-3 col-sm-6"
          style="vertical-align: middle; display: table-cell; text-align: center; display: flex; justify-content: center; align-items: center;">
        </div>

        <div id="emblem" class="col-6 col-md-3 col-sm-6"
          style="vertical-align: middle; display: table-cell; text-align: center; color: white; display: flex; justify-content: center; align-items: center;">

        </div>
        <div id="rank" class="col-6 col-md-3 col-sm-6 center_box">
        </div>

      </div>
    </div>



    <div class="container" style="padding-top: 50px;">


      <div id="row0" class="row" style="color: white;">
        <div id="col00" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col01" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col02" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col04" class="col-6 col-md-4 col-sm-6 center_box">

          <table id="table00" class="table" style="background:rgba(61, 76, 218, 0.5);">
            <thead>

            </thead>
            <tbody>

            </tbody>
          </table>
        </div>
        <div id="col05" class="col-6 col-md-4 col-sm-6 center_box">
          <table id="table01" class="table" style="background:rgba(128, 29, 29, 0.5);">
            <thead>

            </thead>
            <tbody>

            </tbody>
          </table>
        </div>

        <div id="col03" class="offset-3 offset-sm-3 offset-md-0 col-6 col-md-4 col-sm-6 center_box">
        </div>
      </div>


      <div id="row1" class="row" style="color:white;">
        <div id="col10" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col11" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col12" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col14" class="col-6 col-md-4 col-sm-6 center_box">

          <table id="table10" class="table" style="background:rgba(61, 76, 218, 0.5);">
            <thead>

            </thead>
            <tbody>

            </tbody>
          </table>
        </div>
        <div id="col15" class="col-6 col-md-4 col-sm-6 center_box">
          <table id="table11" class="table" style="background:rgba(128, 29, 29, 0.5);">
            <thead>

            </thead>
            <tbody>

            </tbody>
          </table>
        </div>

        <div id="col13" class="offset-3 offset-sm-3 offset-md-0 col-6 col-md-4 col-sm-6 center_box">
        </div>
      </div>


      <div id="row2" class="row" style="color: white;">
        <div id="col20" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col21" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col22" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col24" class="col-6 col-md-4 col-sm-6 center_box">

          <table id="table20" class="table" style="background:rgba(61, 76, 218, 0.5);">
            <thead>

            </thead>
            <tbody>

            </tbody>
          </table>
        </div>
        <div id="col25" class="col-6 col-md-4 col-sm-6 center_box">
          <table id="table21" class="table" style="background:rgba(128, 29, 29, 0.5);">
            <thead>

            </thead>
            <tbody>

            </tbody>
          </table>
        </div>

        <div id="col23" class="offset-3 offset-sm-3 offset-md-0 col-6 col-md-4 col-sm-6 center_box">
        </div>
      </div>

      <div id="row3" class="row" style="color: white;">
        <div id="col30" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col31" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col32" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col34" class="col-6 col-md-4 col-sm-6 center_box">

          <table id="table30" class="table" style="background:rgba(61, 76, 218, 0.5);">
            <thead>

            </thead>
            <tbody>

            </tbody>
          </table>
        </div>
        <div id="col35" class="col-6 col-md-4 col-sm-6 center_box">
          <table id="table31" class="table" style="background:rgba(128, 29, 29, 0.5);">
            <thead>

            </thead>
            <tbody>

            </tbody>
          </table>
        </div>

        <div id="col33" class="offset-3 offset-sm-3 offset-md-0 col-6 col-md-4 col-sm-6 center_box">
        </div>
      </div>

      <div id="row4" class="row" style="color: white;">
        <div id="col40" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col41" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col42" class="col-4 col-md-4 col-sm-4 center_box">
        </div>
        <div id="col44" class="col-6 col-md-4 col-sm-6 center_box">

          <table id="table40" class="table" style="background:rgba(61, 76, 218, 0.5);">
            <thead>

            </thead>
            <tbody>

            </tbody>
          </table>
        </div>
        <div id="col45" class="col-6 col-md-4 col-sm-6 center_box">
          <table id="table41" class="table" style="background:rgba(128, 29, 29, 0.5);">
            <thead>

            </thead>
            <tbody>

            </tbody>
          </table>
        </div>

        <div id="col43" class="offset-3 offset-sm-3 offset-md-0 col-6 col-md-4 col-sm-6 center_box">
        </div>
      </div>
    </div>
    </div>

    <!-- fine stampa-->




<script>
$(document).ready(function () {
    $("#btn-submit").click(function () {
    var player = document.getElementById("summonerName").value;
    if (player == '') alert("Empty summoner name doesn't exists");
    else {  
    
    var spinner = '<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';
    $("#btn-submit").html(spinner);
    var request = $.ajax({
      url: '/lol_review_player?summoner=' + player + '&region=' + $("#regionSelector").val(),
      method: "GET",
      dataType: "json"
    });
    request.done(function( result ) {
      $("#btn-submit").text("Search");
      if (Object.keys(result).length == 1) {
         if (JSON.stringify(result.status).includes("404")) { alert("Player not found"); }
         if (JSON.stringify(result.status).includes("NM")) { alert("Player played 0 games"); }
      }
      else{
        //reset valori delle tabelle
        for (let i = 0; i < 5; i++) {
              let t = document.getElementById('table' + i + '0');
              let t2 = document.getElementById('table' + i + '1');
              var rowCount = t.rows.length;
              for (let j = 0; j < rowCount; j++) {
                t.deleteRow(0);
                t2.deleteRow(0);
              }
      }
        //inserisce i dati nelle loro divisioni
        $("#rowLeague").addClass("riquadro_league");
        $("#rowLeague").css("textShadow", "0 0 10px #000000, 0 0 5px #000000, 0 0 5px #000000");
      
        $("#summ").html("<div><h5>" + result[0].name + "</h5><p>LV: " + result[0].summonerLevel + "</p></div>");

        //check if unranked
        if(result[1].tier != 'unranked'){
        //chart
            $("#piespace").html('<canvas id="piechart"></canvas>');
            var ctx = document.getElementById('piechart');
            new Chart(ctx, {
              type: 'doughnut',
              data: {
                labels: [
                  'Wins',
                  'Losses',
                ],
                datasets: [{
                  label: 'My First Dataset',
                  data: [result[1].wins, result[1].losses],
                  backgroundColor: [
                    '#0000ff',
                    '#ff0000'
                  ],
                  hoverOffset: 4
                }]
              },
              options: {
                legend: {
                  display: false,
                }
              }
            });

            $("#rank").html("<div><p>Tier: " + result[1].tier + "</p><p>Division: " + result[1].rank + "</p><p>LP: " + result[1].leaguePoints + "</p></div>");
        }
        else{
              $("#rank").html("<div><p>Tier: Unranked</p><p>Division: None</p><p>LP: 0</p></div>");
              $("#piespace").html("<div><p>Wins: 0</p><p>Losses: 0</p></div>")
            }

      //Display emblem            
            switch (result[1].tier) {
               case "unranked":
                $("#emblem").html('<%= image_tag "Emblems/Emblem_Unranked.webp", :style => "height: 130px; width: 130px;", :alt=>"UNRANKED" %>');
                break; 
              case "IRON":
                $("#emblem").html('<%= image_tag "Emblems/Emblem_Iron.png", :style => "height: 130px; width: 130px;", :alt=>"IRON" %>');
                break;
              case "BRONZE":
                $("#emblem").html('<%= image_tag "Emblems/Emblem_Bronze.png", :style => "height: 130px; width: 130px;", :alt=>"BRONZE" %>');
                break;
              case "SILVER":
                $("#emblem").html('<%= image_tag "Emblems/Emblem_Silver.png", :style => "height: 130px; width: 130px;", :alt=>"SILVER" %>');
                break;
              case "GOLD":
                $("#emblem").html('<%= image_tag "Emblems/Emblem_Gold.png", :style => "height: 130px; width: 130px;", :alt=>"GOLD" %>');
                break;
              case "PLATINUM":
                $("#emblem").html('<%= image_tag "Emblems/Emblem_Platinum.png", :style => "height: 130px; width: 130px;", :alt=>"PLATINUM" %>');
                break;
              case "DIAMOND":
                $("#emblem").html('<%= image_tag "Emblems/Emblem_Diamond.png", :style => "height: 130px; width: 130px;", :alt=>"DIAMOND" %>');
                break;
              case "MASTER":
                $("#emblem").html('<%= image_tag "Emblems/Emblem_Master.png", :style => "height: 130px; width: 130px;", :alt=>"MASTER" %>');
                break;
              case "GRANDMASTER":
                $("#emblem").html('<%= image_tag "Emblems/Emblem_Grandmaster.png", :style => "height: 130px; width: 130px;", :alt=>"GRANDMASTER" %>');
                break;
              case "CHALLENGER":
                $("#emblem").html('<%= image_tag "Emblems/Emblem_Challenger.png", :style => "height: 130px; width: 130px;", :alt=>"CHALLENGER" %>');
                break;
              default:
                alert("Something went wrong!");
            }


      //print table
            for (var i = 0; i < 5; i++) { 
              $("#row"+i).css("background-color", "rgba(26, 27, 63, 0.459)");
              $("#row"+i).css("textShadow", "0 0 10px #000000, 0 0 5px #000000, 0 0 5px #000000");
              $("#row"+i).addClass("resize");
              var row = document.getElementById("row" + i)



              var table = document.getElementById("table" + i + "0").getElementsByTagName('thead')[0];
              var row = table.insertRow(0);
              var cell1 = row.insertCell(0);
              cell1.innerHTML = "TEAM1";
              var table2 = document.getElementById("table" + i + "1").getElementsByTagName('thead')[0];
              var row = table2.insertRow(0);
              var cell1 = row.insertCell(0);
              cell1.innerHTML = "TEAM2";

              if (result[2][i].win) {
                let team = "a", team2 = "b";
                if (result[2][i].teamid == 200) { team = "b"; team2 = "a"; }
                outcome = "WIN";
                $("#col" + i + "0").html("<div><p style='font-size:18px;'>" + result[2][i].gameMode.toUpperCase() + "</p><p style='font-size:18px;'>" + result[2][i].gameType.toUpperCase() + "</p><p style='color:#0000ff;font-size:40px;'>" + outcome + "</p><p>Duration: " + Math.floor(result[2][i].gameDuration / 60) + ":" + (result[2][i].gameDuration % 60 ? result[2][i].gameDuration % 60 : '00') + "</p></div>");
                $("#row" + i).removeClass('outcome_lose');
                $("#row" + i).addClass('outcome_win');
                //table players
                var table = document.getElementById("table" + i + "0").getElementsByTagName('tbody')[0];
                var table2 = document.getElementById("table" + i + "1").getElementsByTagName('tbody')[0];

                for (let x = 0; x < 5; x++) {
                  var row = table.insertRow(x);
                  var cell1 = row.insertCell(0);
                  cell1.innerHTML = result[3][i][team2.toUpperCase() + "_name_" + (x + 1)];

                  var row = table2.insertRow(x);
                  var cell1 = row.insertCell(0);
                  cell1.innerHTML = result[3][i][team.toUpperCase() + "_name_" + (x + 1)];
                }
              }
              else {
                let team = "b", team2 = "a";
                if (result[2][i].teamid == 200) { team = "a"; team2 = "b"; }
                outcome = "LOSS";
                $("#col" + i + "0").html("<div><p style='font-size:18px;'>" + result[2][i].gameMode.toUpperCase() + "</p><p style='font-size:18px;'>" + result[2][i].gameType.toUpperCase() + "</p><p style='color:#ff0000;font-size:40px;'>" + outcome + "</p><p>Duration: " + Math.floor(result[2][i].gameDuration / 60) + ":" + (result[2][i].gameDuration % 60 ? result[2][i].gameDuration % 60 : '00') + "</p></div>");
                $("#row" + i).removeClass('outcome_win');
                $("#row" + i).addClass('outcome_lose');

                var table = document.getElementById("table" + i + "0").getElementsByTagName('tbody')[0];
                var table2 = document.getElementById("table" + i + "1").getElementsByTagName('tbody')[0];
                for (let x = 0; x < 5; x++) {
                  var row = table.insertRow(x);
                  var cell1 = row.insertCell(0);
                  cell1.innerHTML = result[3][i][team.toUpperCase() + "_name_" + (x + 1)];

                  var row = table2.insertRow(x);
                  var cell1 = row.insertCell(0);
                  cell1.innerHTML = result[3][i][team2.toUpperCase() + "_name_" + (x + 1)];
                }
              }

              $("#col" + i + "1").html("<div><p style='font-size:25px'>" + result[2][i].championName + "</p><p>Lane: " + result[2][i].lane.toUpperCase() + "</p><p>LV: " + result[2][i].champLevel + "</p></div>");

              $("#col" + i + "2").html("<div><p style='font-size:25px;';>K/D/A : "
                + result[2][i].kills + "/" + result[2][i].deaths + "/" + result[2][i].assists + "</p><h6 style='color:#a38b02;font-size:25px'>Gold: " + result[2][i].goldEarned + "</h6><p style='color:#05a005;font-size:25px'>Vision score: " + result[2][i].visionScore + "</div>");

                  
              $("#col" + i + "3").html('<canvas id="pie' + i + '"></canvas>');
              ctx = document.getElementById('pie' + i);
              new Chart(ctx, {
                type: 'doughnut',
                data: {
                  labels: [
                    'Physical',
                    'Magical',
                    'True',
                  ],
                  datasets: [{
                    label: 'My First Dataset',
                    data: [result[2][i].physicalDamageDealt, result[2][i].magicDamageDealt, result[2][i].trueDamageDealt],
                    backgroundColor: [
                      '#FFA500',
                      '#4B0082',
                      '#d0d0d0'
                    ],
                    hoverOffset: 2
                  }]
                },
                options: {
                legend: {
                  display: false,
                }
              }
              });    
            
            


      }
      }








    });
 
    request.fail(function( jqXHR, textStatus ) {
      $("#btn-submit").text("Search");
      alert( "Request failed: " + textStatus );
    });
    
    }});
  });
</script>


  </main>
<% end %>